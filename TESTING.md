# Phase 2 èªè­‰ç³»çµ±æ¸¬è©¦æŒ‡å—

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•æ¸¬è©¦ç¾½çƒæ’é»ç³»çµ±çš„èªè­‰åŠŸèƒ½ã€‚

## å‰ç½®æº–å‚™

### 1. å•Ÿå‹•å¾Œç«¯æœå‹™å™¨

```bash
cd backend
npm run dev
```

é æœŸè¼¸å‡ºï¼š
```
ğŸš€ Server started on port 3001
Environment: development
API Documentation: http://localhost:3001/api/docs
```

### 2. å•Ÿå‹•å‰ç«¯æ‡‰ç”¨

åœ¨å¦ä¸€å€‹çµ‚ç«¯ï¼š
```bash
cd frontend
npm run dev
```

é æœŸè¼¸å‡ºï¼š
```
   â–² Next.js 15.x.x
   - Local:        http://localhost:3000
```

### 3. è¨ªå•æ‡‰ç”¨

æ‰“é–‹ç€è¦½å™¨è¨ªå•ï¼šhttp://localhost:3000

## æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1: æ–°ç”¨æˆ¶è¨»å†Š

#### æ¸¬è©¦æ­¥é©Ÿ

1. é»æ“Šé¦–é çš„ã€Œè¨»å†Šã€æŒ‰éˆ•
2. å¡«å¯«ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **éƒµç®±**: `testuser@example.com`
   - **å§“å**: `æ¸¬è©¦ç”¨æˆ¶`
   - **å¯†ç¢¼**: `password123`
   - **ç¢ºèªå¯†ç¢¼**: `password123`
   - **ç¾½çƒç­‰ç´š**: é¸æ“‡ã€Œä¸­ç´š (5)ã€
   - **é›»è©±**: `+886912345678`ï¼ˆé¸æ“‡æ€§ï¼‰
3. é»æ“Šã€Œå»ºç«‹å¸³æˆ¶ã€

#### é æœŸçµæœ

- âœ… è¡¨å–®é©—è­‰æˆåŠŸ
- âœ… ç”¨æˆ¶è¢«å‰µå»ºä¸¦è‡ªå‹•ç™»å…¥
- âœ… é‡å®šå‘åˆ°å„€è¡¨æ¿
- âœ… é¡¯ç¤ºç”¨æˆ¶åã€Œæ¸¬è©¦ç”¨æˆ¶ã€

#### å¸¸è¦‹é©—è­‰éŒ¯èª¤æ¸¬è©¦

**ç„¡æ•ˆéƒµç®±**:
- è¼¸å…¥: `invalidemail`
- é æœŸ: ã€ŒInvalid email formatã€

**å¯†ç¢¼éçŸ­**:
- è¼¸å…¥: `123`
- é æœŸ: ã€ŒPassword must be at least 6 charactersã€

**å¯†ç¢¼ä¸åŒ¹é…**:
- å¯†ç¢¼: `password123`
- ç¢ºèªå¯†ç¢¼: `password456`
- é æœŸ: ã€ŒPasswords do not matchã€

**éƒµç®±å·²å­˜åœ¨** (ç¬¬äºŒæ¬¡åŒéƒµç®±è¨»å†Š):
- é æœŸ: ã€ŒEmail already registeredã€

### å ´æ™¯ 2: ç”¨æˆ¶ç™»å…¥

#### æ¸¬è©¦æ­¥é©Ÿ

1. å¾å„€è¡¨æ¿é»æ“Šã€Œç™»å‡ºã€
2. åœ¨é¦–é é»æ“Šã€Œç™»å…¥ã€
3. å¡«å¯«ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **éƒµç®±**: `testuser@example.com`
   - **å¯†ç¢¼**: `password123`
4. é»æ“Šã€Œç™»å…¥ã€

#### é æœŸçµæœ

- âœ… ç™»å…¥æˆåŠŸ
- âœ… é‡å®šå‘åˆ°å„€è¡¨æ¿
- âœ… Token å„²å­˜åœ¨ localStorage ä¸­

#### å¤±æ•—æƒ…æ³æ¸¬è©¦

**éƒµç®±ä¸å­˜åœ¨**:
- è¼¸å…¥éå­˜åœ¨çš„éƒµç®±
- é æœŸ: ã€ŒUser not foundã€

**å¯†ç¢¼éŒ¯èª¤**:
- è¼¸å…¥æ­£ç¢ºéƒµç®±ï¼ŒéŒ¯èª¤å¯†ç¢¼
- é æœŸ: ã€ŒInvalid passwordã€

### å ´æ™¯ 3: å€‹äººè³‡æ–™ç®¡ç†

#### æ¸¬è©¦æ­¥é©Ÿ

1. å¾å„€è¡¨æ¿é€²å…¥ã€Œå€‹äººè³‡æ–™ã€
2. ä¿®æ”¹ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **å§“å**: æ”¹ç‚ºã€ŒUpdated Userã€
   - **é›»è©±**: æ”¹ç‚ºã€Œ+886987654321ã€
   - **ç¾½çƒç­‰ç´š**: æ”¹ç‚ºã€Œé«˜ç´š (8)ã€
3. é»æ“Šã€Œä¿å­˜æ›´æ”¹ã€

#### é æœŸçµæœ

- âœ… è¡¨å–®é©—è­‰é€šé
- âœ… é¡¯ç¤ºã€Œè³‡æ–™å·²æˆåŠŸæ›´æ–°ï¼ã€æˆåŠŸæç¤º
- âœ… æ›´æ–°å¾Œçš„ä¿¡æ¯è¢«ä¿å­˜
- âœ… åˆ·æ–°é é¢å¾Œæ–°ä¿¡æ¯ä»ç„¶å­˜åœ¨

### å ´æ™¯ 4: Token é©—è­‰

#### é€šé API æ¸¬è©¦ Token é©—è­‰

**ç²å–ç•¶å‰ç”¨æˆ¶ä¿¡æ¯**:
```bash
curl -H "Authorization: Bearer <YOUR_JWT_TOKEN>" \
  http://localhost:3001/api/auth/me
```

é æœŸéŸ¿æ‡‰ï¼š
```json
{
  "data": {
    "id": "...",
    "email": "testuser@example.com",
    "name": "æ¸¬è©¦ç”¨æˆ¶",
    "role": "PLAYER",
    "token": ""
  }
}
```

**ç„¡æ•ˆ Token æ¸¬è©¦**:
```bash
curl -H "Authorization: Bearer invalid_token" \
  http://localhost:3001/api/auth/me
```

é æœŸéŸ¿æ‡‰ï¼š
```json
{
  "error": "Invalid or expired token"
}
```

### å ´æ™¯ 5: æœƒè©±ç®¡ç†

#### æ¸¬è©¦æ­¥é©Ÿ

1. æˆåŠŸç™»å…¥å¾Œ
2. æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
3. é€²å…¥ Application â†’ Local Storage
4. é©—è­‰ `authToken` å’Œ `user` å·²ä¿å­˜

#### é æœŸçµæœ

- âœ… `authToken` åŒ…å«æœ‰æ•ˆçš„ JWT token
- âœ… `user` åŒ…å«ç”¨æˆ¶ä¿¡æ¯ï¼ˆJSON æ ¼å¼ï¼‰
- âœ… åˆ·æ–°é é¢å¾Œç”¨æˆ¶ä»ç„¶ç™»å…¥

### å ´æ™¯ 6: ç™»å‡ºå’Œæ¸…ç†

#### æ¸¬è©¦æ­¥é©Ÿ

1. ç™»å…¥å¾Œé€²å…¥å„€è¡¨æ¿
2. é»æ“Šå³ä¸Šè§’çš„ã€Œç™»å‡ºã€
3. æª¢æŸ¥ localStorage

#### é æœŸçµæœ

- âœ… `authToken` å’Œ `user` å¾ localStorage ç§»é™¤
- âœ… é‡å®šå‘åˆ°é¦–é 
- âœ… ç„¡æ³•è¨ªå•å—ä¿è­·çš„è·¯ç”±ï¼ˆè‡ªå‹•é‡å®šå‘åˆ°ç™»å…¥ï¼‰

## API ç«¯é»æ¸¬è©¦

### ä½¿ç”¨ Postman æˆ– cURL æ¸¬è©¦

#### 1. ç”¨æˆ¶è¨»å†Š

```bash
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "newuser@example.com",
    "password": "password123",
    "name": "æ–°ç”¨æˆ¶",
    "skillLevel": 5,
    "phone": "+886912345678"
  }'
```

#### 2. ç”¨æˆ¶ç™»å…¥

```bash
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "testuser@example.com",
    "password": "password123"
  }'
```

#### 3. ç²å–ç•¶å‰ç”¨æˆ¶ï¼ˆéœ€è¦ Tokenï¼‰

```bash
curl -X GET http://localhost:3001/api/auth/me \
  -H "Authorization: Bearer <JWT_TOKEN>"
```

#### 4. æ›´æ–°å€‹äººè³‡æ–™

```bash
curl -X PUT http://localhost:3001/api/auth/profile \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  -d '{
    "name": "æ›´æ–°åç¨±",
    "phone": "+886987654321",
    "skillLevel": 7
  }'
```

## ç€è¦½å™¨æ§åˆ¶å°æ¸¬è©¦

### æª¢æŸ¥ AuthContext

åœ¨ç€è¦½å™¨æ§åˆ¶å°ä¸­ï¼š

```javascript
// æª¢æŸ¥ localStorage ä¸­çš„ token
console.log(localStorage.getItem('authToken'));

// æª¢æŸ¥ç”¨æˆ¶ä¿¡æ¯
console.log(JSON.parse(localStorage.getItem('user')));
```

## æ•…éšœæ’é™¤

### å•é¡Œ 1: CORS éŒ¯èª¤

**ç—‡ç‹€**: ã€ŒAccess to XMLHttpRequest has been blocked by CORS policyã€

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºä¿å¾Œç«¯ CORS é…ç½®æ­£ç¢º
2. æª¢æŸ¥ `backend/.env` ä¸­çš„ `CORS_ORIGIN`
3. ç¢ºä¿å‰ç«¯é‹è¡Œåœ¨ `http://localhost:3000`

### å•é¡Œ 2: Token ç„¡æ•ˆ

**ç—‡ç‹€**: ç™»å…¥å¾Œä»ç„¶ç„¡æ³•è¨ªå•å—ä¿è­·ç«¯é»

**è§£æ±ºæ–¹æ¡ˆ**:
1. æ¸…é™¤ localStorageï¼ˆ`Application` â†’ `Local Storage` â†’ æ¸…é™¤æ‰€æœ‰ï¼‰
2. é‡æ–°ç™»å…¥
3. æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤

### å•é¡Œ 3: ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯

**ç—‡ç‹€**: ã€ŒFailed to fetchã€æˆ–ã€ŒConnection refusedã€

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèªå¾Œç«¯æœå‹™å™¨æ­£åœ¨é‹è¡Œï¼ˆ`npm run dev`ï¼‰
2. æª¢æŸ¥å¾Œç«¯é‹è¡Œåœ¨ `http://localhost:3001`
3. ç¢ºèªé˜²ç«ç‰†æœªé˜»æ­¢é€£æ¥
4. æª¢æŸ¥ `.env` å’Œ `.env.local` ä¸­çš„ URL é…ç½®

## æ€§èƒ½æ¸¬è©¦

### è¨»å†Š/ç™»å…¥éŸ¿æ‡‰æ™‚é–“

é æœŸéŸ¿æ‡‰æ™‚é–“ï¼š< 500ms

ä½¿ç”¨ Performance tabï¼ˆåœ¨é–‹ç™¼è€…å·¥å…·ä¸­ï¼‰ï¼š
1. æ‰“é–‹ Network tab
2. åŸ·è¡Œç™»å…¥/è¨»å†Šæ“ä½œ
3. æª¢æŸ¥ API è«‹æ±‚çš„éŸ¿æ‡‰æ™‚é–“

## å®‰å…¨æ€§æ¸¬è©¦

### 1. å¯†ç¢¼å®‰å…¨

- âœ… å¯†ç¢¼å·²æ­£ç¢ºåŠ å¯†ï¼ˆbcryptï¼‰
- âœ… å¯†ç¢¼æœªåœ¨éŸ¿æ‡‰ä¸­è¿”å›
- âœ… å¯†ç¢¼å„²å­˜åœ¨ PostgreSQL/SQLite ä¸­å·²åŠ å¯†

### 2. Token å®‰å…¨

- âœ… JWT token ç°½åæ­£ç¢º
- âœ… Token éæœŸæ™‚é–“è¨­ç½®æ­£ç¢ºï¼ˆ7 å¤©ï¼‰
- âœ… Invalid token è¢«æ­£ç¢ºæ‹’çµ•

### 3. è¼¸å…¥é©—è­‰

- âœ… æ‰€æœ‰è¼¸å…¥åœ¨å¾Œç«¯å’Œå‰ç«¯é€²è¡Œé©—è­‰
- âœ… SQL injection é˜²è­·ï¼ˆä½¿ç”¨ Prismaï¼‰
- âœ… XSS é˜²è­·ï¼ˆä½¿ç”¨ React è‡ªå‹•è½‰ç¾©ï¼‰

## å®Œæ•´æ¸¬è©¦æ¸…å–®

- [ ] ç”¨æˆ¶è¨»å†ŠæˆåŠŸ
- [ ] éƒµç®±é©—è­‰å·¥ä½œ
- [ ] å¯†ç¢¼é©—è­‰å·¥ä½œ
- [ ] ç”¨æˆ¶ç™»å…¥æˆåŠŸ
- [ ] ç„¡æ•ˆå¯†ç¢¼è¢«æ‹’çµ•
- [ ] Token æ­£ç¢ºç”Ÿæˆ
- [ ] Token é©—è­‰å·¥ä½œ
- [ ] å—ä¿è­·çš„è·¯ç”±æ­£ç¢ºä¿è­·
- [ ] ç”¨æˆ¶ä¿¡æ¯æ­£ç¢ºè¿”å›
- [ ] å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸ
- [ ] ç™»å‡ºæ¸…ç† localStorage
- [ ] CORS æ­£ç¢ºé…ç½®
- [ ] éŒ¯èª¤æ¶ˆæ¯æ¸…æ™°
- [ ] éŸ¿æ‡‰æ™‚é–“åœ¨é æœŸå…§
- [ ] å¯†ç¢¼æ­£ç¢ºåŠ å¯†

## ä¸‹ä¸€æ­¥

Phase 2 èªè­‰ç³»çµ±å®Œæˆå¾Œï¼Œä¸‹ä¸€æ­¥æ˜¯ **Phase 3: æ´»å‹•ç®¡ç†åŠŸèƒ½**ï¼ŒåŒ…æ‹¬ï¼š
- [ ] æ´»å‹• CRUD API
- [ ] æ´»å‹•å ±ååŠŸèƒ½
- [ ] å‰ç«¯æ´»å‹•ç®¡ç†é é¢
- [ ] åƒèˆ‡è€…ç®¡ç†

è©³æƒ…è¦‹ `/Users/hongqishun/.claude/plans/vivid-bouncing-bunny.md`ã€‚
